<div class="dashboard">
  <app-ssc-sidebar></app-ssc-sidebar>

  <main class="main-content">
    <h1>Clearance Approvers Management</h1>
    <p class="page-subtitle">Manage clearance approvers for organizations</p>

    <div class="section">
      <div class="section-header">
        <h2>Clearance Approver List</h2>
        <button class="btn btn-primary btn-sm" (click)="openAddModal()">âž• Add Approver</button>
      </div>

      <div class="filters-bar">
        <div class="filter-group">
          <label>Search</label>
          <input type="text" [(ngModel)]="searchTerm" placeholder="Name or organization...">
        </div>

        <div class="filter-group">
          <label>Role Type</label>
          <select [(ngModel)]="roleFilter">
            <option value="">All Role Types</option>
            <option value="Student Leader">Student Leader</option>
            <option value="Faculty Adviser">Faculty Adviser</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Status</label>
          <select [(ngModel)]="statusFilter">
            <option value="">All Status</option>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Title</th>
            <th>Department</th>
            <th>Organization</th>
            <th>Role</th>
            <th>Type</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let a of filteredApprovers">
            <td>{{a.id}}</td>
            <td>{{a.name}}</td>
            <td>{{a.title}}</td>
            <td>{{a.department}}</td>
            <td>{{a.organization}}</td>
            <td><span class="badge badge-warning">{{a.role}}</span></td>
            <td><span class="badge badge-secondary">{{a.type}}</span></td>
            <td><span class="badge approved">{{a.status}}</span></td>
            <td style="display: flex; gap: 4px;">
              <button class="btn-sm btn-warning" (click)="openEditModal(a)">Edit</button>
              <button class="btn-sm btn-danger" (click)="deleteApprover(a)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<!-- =========================
     ADD APPROVER MODAL
========================= -->
<div class="modal" [class.active]="showAddModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add New Clearance Approver</h2>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>

    <form (ngSubmit)="submitAddApprover()">
      <div class="form-group">
        <label>Faculty ID / Employee ID *</label>
        <input type="text" [(ngModel)]="form.facultyID" name="facultyID" required placeholder="e.g., FAC-2024-001">
      </div>

      <div class="form-group">
        <label>Full Name *</label>
        <input type="text" [(ngModel)]="form.name" name="name" required placeholder="e.g., Prof. John Smith">
      </div>

      <div class="form-group">
        <label>Organization *</label>
        <select [(ngModel)]="form.organization" name="organization" required>
          <option value="">-- Select Organization --</option>
          <option value="BSIT Digits Organization">BSIT Digits Organization</option>
          <option value="BSCS Lambda Organization">BSCS Lambda Organization</option>
          <option value="BSCE Engineering Organization">BSCE Engineering Organization</option>
        </select>
      </div>

      <div class="form-group">
        <label>Email Address *</label>
        <input type="email" [(ngModel)]="form.email" name="email" required placeholder="e.g., john@school.edu">
      </div>

      <div class="form-group">
        <label>Confirm Email Address *</label>
        <input type="email" [(ngModel)]="form.confirmEmail" name="confirmEmail" required placeholder="Confirm email">
        <small class="error" *ngIf="emailMismatch">Emails do not match</small>
      </div>

      <div class="form-group">
        <label>Default Clearance Requirements *</label>
        <div style="border: 1px solid #ddd; border-radius: 6px; padding: 12px; max-height: 150px; overflow-y: auto; background: #f9f9f9;">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <input type="checkbox" name="requirements" value="Treasurer Clearance" id="reqTreasurer" (change)="toggleRequirement('Treasurer Clearance')" [checked]="form.requirements.includes('Treasurer Clearance')">
            <label for="reqTreasurer" style="margin-left: 6px; margin-bottom: 0; cursor: pointer;">Treasurer Clearance</label>
          </div>
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <input type="checkbox" name="requirements" value="Year Level Officer Clearance" id="reqYLO" (change)="toggleRequirement('Year Level Officer Clearance')" [checked]="form.requirements.includes('Year Level Officer Clearance')">
            <label for="reqYLO" style="margin-left: 6px; margin-bottom: 0; cursor: pointer;">Year Level Officer Clearance</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Password *</label>
        <input type="password" [(ngModel)]="form.password" name="password" required>
      </div>

      <div class="form-group">
        <label>Confirm Password *</label>
        <input type="password" [(ngModel)]="form.confirmPassword" name="confirmPassword" required>
        <small class="error" *ngIf="passwordMismatch">Passwords do not match</small>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" [(ngModel)]="form.agree" name="agree" required>
          I agree to the terms and conditions
        </label>
      </div>

      <div class="action-buttons">
        <button type="submit" class="btn btn-primary">Add Approver & Send Notification</button>
        <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- =========================
     EDIT APPROVER MODAL
========================= -->
<div class="modal" [class.active]="showEditModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Edit Approver</h2>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>

    <form (ngSubmit)="submitEditApprover()">
      <div class="form-group">
        <label>Faculty ID / Employee ID *</label>
        <input type="text" [(ngModel)]="form.facultyID" name="facultyID" required readonly>
      </div>

      <div class="form-group">
        <label>Full Name *</label>
        <input type="text" [(ngModel)]="form.name" name="name" required>
      </div>

      <div class="form-group">
        <label>Organization *</label>
        <select [(ngModel)]="form.organization" name="organization" required>
          <option value="">-- Select Organization --</option>
          <option value="BSIT Digits Organization">BSIT Digits Organization</option>
          <option value="BSCS Lambda Organization">BSCS Lambda Organization</option>
          <option value="BSCE Engineering Organization">BSCE Engineering Organization</option>
        </select>
      </div>

      <div class="form-group">
        <label>Email Address *</label>
        <input type="email" [(ngModel)]="form.email" name="email" required>
      </div>

      <div class="form-group">
        <label>Confirm Email Address *</label>
        <input type="email" [(ngModel)]="form.confirmEmail" name="confirmEmail" required>
        <small class="error" *ngIf="emailMismatch">Emails do not match</small>
      </div>

      <div class="form-group">
        <label>Default Clearance Requirements *</label>
        <div style="border: 1px solid #ddd; border-radius: 6px; padding: 12px; max-height: 150px; overflow-y: auto; background: #f9f9f9;">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <input type="checkbox" name="requirements" value="Treasurer Clearance" id="editReqTreasurer" (change)="toggleRequirement('Treasurer Clearance')" [checked]="form.requirements.includes('Treasurer Clearance')">
            <label for="editReqTreasurer" style="margin-left: 6px; margin-bottom: 0; cursor: pointer;">Treasurer Clearance</label>
          </div>
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <input type="checkbox" name="requirements" value="Year Level Officer Clearance" id="editReqYLO" (change)="toggleRequirement('Year Level Officer Clearance')" [checked]="form.requirements.includes('Year Level Officer Clearance')">
            <label for="editReqYLO" style="margin-left: 6px; margin-bottom: 0; cursor: pointer;">Year Level Officer Clearance</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Password *</label>
        <input type="password" [(ngModel)]="form.password" name="password">
        <small style="color: #7f8c8d;">Leave blank to keep current password</small>
      </div>

      <div class="form-group">
        <label>Confirm Password *</label>
        <input type="password" [(ngModel)]="form.confirmPassword" name="confirmPassword">
        <small class="error" *ngIf="passwordMismatch">Passwords do not match</small>
      </div>

      <div class="action-buttons">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>
